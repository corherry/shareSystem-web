<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>帖子详情</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="帖子详情">
  <meta name="description" content="帖子详情">
  <link rel="stylesheet" href="../resources/layui/css/layui.css">
  <link rel="stylesheet" href="../css/global.css">
</head>

<body>

  <div class="fly-header layui-bg-black">
    <div class="layui-container">
      <a class="fly-logo" href="index.html">
        <img src="../images/logo-min.png" alt="layui">
      </a>

      <div class="layui-form component">
        <input type="text" placeholder="搜索帖子或用户" value="" class="layui-input" id="search_text">
      </div>

      <div class="layui-form search">
        <select name="searchType" lay-verify="required" id="search_select">
          <option value="1" select="">帖子</option>
          <option value="2">用户</option>
        </select>
      </div>

      <div class="search-icon">
        <span class="fly-search">
          <i class="layui-icon" onclick="search()"></i>
        </span>
      </div>

      <ul class="layui-nav fly-nav-user">

        <li class="layui-nav-item">
          <a class="fly-nav-avatar" href="javascript:;" id="headUser">

            <img src="../images/default_userHeadPic.gif" id="head_userPic">&nbsp;&nbsp;

            <cite class="layui-hide-xs" id="head_username"></cite>
          </a>
          <dl class="layui-nav-child">
            <dd>
              <a href="home.html">
                <i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe68e;</i>我的主页</a>
            </dd>
            <dd>
              <a href="userCenter.html">
                <i class="layui-icon" style="margin-left: 2px; font-size: 22px;">&#xe612;</i>用户中心</a>
            </dd>
            <dd>
              <a href="set.html">
                <i class="layui-icon">&#xe620;</i>基本设置</a>
            </dd>
            <!-- <dd>
              <a href="message.html">
                <i class="iconfont icon-tongzhi" style="top: 4px;"></i>我的消息</a>
            </dd> -->

            <hr style="margin: 5px 0;">
            <dd>
              <a style="text-align: center;" onclick="logout()">退出</a>
            </dd>
          </dl>
        </li>

      </ul>
    </div>
  </div>


  <div class="layui-container" style="margin-top: 20px">
    <div class="layui-row layui-col-space10">
      <div class="layui-col-md10 content detail">
        <div class="fly-panel detail-box">
          <h1 id="title">
            <div style="display: inline-block; float: right; display: none" id="show_authority">
              <form class="layui-form">
                <div class="layui-form-item">
                  <div class="layui-input-block" style="width: 150px; margin-left: 0px; font-size: 14px">
                    <select lay-verify="required" name="class" lay-filter="authority" id="authority">
                      <option value="3" selected>所有人可见</option>
                      <option value="2" selected>仅好友可见</option>
                      <option value="1" selected>仅自己可见</option>
                    </select>
                  </div>
                </div>
              </form>
            </div>
          </h1>
          <div class="fly-detail-info">
            <span class="layui-badge layui-bg-green fly-detail-column" id="category"></span>

            <!-- <div class="fly-admin-box" data-id="123">
              

            </div> -->

            <span class="fly-list-nums">
              <i class="iconfont" title="人气">&#xe60b;</i>
              <span id="see"> </span>
              <a href="#comment">
                <i class="iconfont" title="回答">&#xe60c;</i>
                <span id="comment"> </span>
              </a>
              <i class="iconfont icon-zan zanok" id="zan"></i>
              <span id="zancount"> </span>
            </span>

          </div>
          <div class="detail-about">
            <a class="fly-avatar" href="home.html" id="link_pic">
              <img src="../images/default_userHeadPic.gif" alt="贤心" id="headPic">
            </a>
            <div class="fly-detail-user">
              <a href="home.html" class="fly-link" id="link_name">
                <cite id="userName"></cite>&nbsp;

                <i class="layui-badge fly-badge-vip" id="level"></i>
              </a>
            </div>
            <div class="detail-hits" id="LAY_jieAdmin" data-id="123">
              <span style="padding-right: 10px; " id="addtime"></span>
              <span class="layui-btn layui-btn-xs jie-admin" type="collect" id="collect"></span>
              <span class="layui-btn layui-btn-xs jie-admin layui-btn-danger" type="del" style="display: none" id="delete">删除</span>
            </div>
          </div>
          <div class="detail-body photos">
            <p id="topic_content">

            </p>
            <div class="layui-carousel" id="test1" style="margin:auto;">
              <div carousel-item id="picGroup">

              </div>
            </div>
          </div>

          <div class="fly-panel detail-box" id="flyReply">
            <fieldset class="layui-elem-field layui-field-title" style="text-align: center;">
              <legend>回帖</legend>
            </fieldset>

            <ul class="jieda" id="jieda">

              <!-- 无数据时 -->
              <li class="fly-none" style="display: none" id="none-comment">暂时还没有评论～</li>
            </ul>
            <hr>
            <div id="demo1" style="float: right"></div>

            <div class="layui-form layui-form-pane">
              <form>
                <div class="layui-form-item layui-form-text">
                  <a name="comment"></a>
                  <div class="layui-input-block">
                    <textarea id="L_content" name="content" required lay-verify="required" placeholder="请输入内容" class="layui-textarea fly-editor"
                      style="height: 150px;"></textarea>
                  </div>
                </div>
                <div class="layui-form-item">
                  <button class="layui-btn" lay-filter="comment" lay-submit>提交回复</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="fly-footer">
      <p>
        <a href="#" target="_blank">Copyright © 2018 北京理工大学珠海学院、Marjane</a>
      </p>
    </div>

    <script src="../js/jquery-2.1.4.min.js"></script>
    <script src="../js/jie.js"></script>
    <script src="../resources/layui/layui.js"></script>
    <script src="../js/global.js"></script>
    <script src="../js/detail.js"></script>

    <script>
      var userId = getUserId();
      var topicId = getQueryString("topicId");
      var page = 1;
      var size = 10;
      var commentCount = 0;
      window.onload = function () {
        $('#LAY_jieAdmin').attr('data-id', topicId);
        getExpression();
        updateSeeCount(userId, topicId);
        queryCommentCount(topicId);
        queryComment(topicId, page, size);
        queryMyHeadInfo(userId);
        queryTopicDetail(userId, topicId);
      }
      layui.use('form', function () {
        var form = layui.form;

        form.on('select(authority)', function (data) {
          var authority = data.value;
          updateAuthority(topicId, authority);
        });
        form.on('submit(comment)', function (data) {
          data = data.field;
          addComment(userId, topicId, data.content);
          return false;
        });

      });
    </script>
    <script>
      layui.cache.page = 'jie';
      layui.cache.user = {
        username: '游客',
        uid: -1,
        avatar: '../../res/images/avatar/00.jpg',
        experience: 83,
        sex: '男'
      };
      layui.use(['laypage', 'layer'], function () {
        var laypage = layui.laypage,
          layer = layui.layer;

        //总页数大于页码总数
        laypage.render({
          elem: 'demo1',
          count: commentCount, //数据总数
          jump: function (obj) {
            queryComment(topicId, obj.curr, size);
          }
        });
      });
      layui.use('carousel', function () {
        var carousel = layui.carousel;
        //建造实例
        carousel.render({
          elem: '#test1',
          width: '400px' //设置容器宽度

        });
      });
      layui.config({
        version: "3.0.0",
        base: '../js/'
      }).extend({
        fly: 'index'
      }).use(['fly', 'face'], function () {
        var $ = layui.$,
          fly = layui.fly;

      });
    </script>

</body>

</html>